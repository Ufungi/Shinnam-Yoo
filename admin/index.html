<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Site Admin</title>
    <style>
        :root {
            --bg:    #1a0f07;
            --panel: #231508;
            --card:  rgba(255,255,255,0.06);
            --text:  #f0ebe0;
            --muted: #c4aa88;
            --accent:#c19a6b;
            --border:rgba(193,154,107,0.25);
            --red:   #c96b6b;
        }
        * { margin:0; padding:0; box-sizing:border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }
        .container { width: 100%; max-width: 420px; }
        h1 {
            font-size: 1.3rem;
            font-weight: 500;
            color: var(--accent);
            margin-bottom: 2rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--border);
            letter-spacing: 0.04em;
        }
        /* LOGIN */
        #loginSection h2 {
            font-size: 1rem;
            font-weight: 400;
            color: var(--muted);
            margin-bottom: 1rem;
        }
        #patInput {
            width: 100%;
            padding: 0.65rem 0.9rem;
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text);
            font-size: 0.95rem;
            font-family: monospace;
            margin-bottom: 0.75rem;
            outline: none;
        }
        #patInput:focus { border-color: var(--accent); }
        #loginHint {
            font-size: 0.78rem;
            color: var(--muted);
            margin-bottom: 1.25rem;
            line-height: 1.5;
        }
        #loginHint a { color: var(--accent); }
        #loginStatus { font-size: 0.85rem; margin-top: 0.75rem; color: var(--muted); }
        /* LOGGED-IN PANEL */
        #loggedSection { display: none; text-align: center; }
        .user-greeting {
            font-size: 0.9rem;
            color: var(--muted);
            margin-bottom: 2rem;
        }
        .user-greeting strong { color: var(--text); }
        .edit-btn {
            display: block;
            width: 100%;
            padding: 0.9rem 1.5rem;
            background: var(--accent);
            color: #1a0f07;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            margin-bottom: 1rem;
            transition: opacity 0.2s;
        }
        .edit-btn:hover { opacity: 0.85; }
        .page-links {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }
        .page-link {
            padding: 0.55rem 0.75rem;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--muted);
            text-decoration: none;
            font-size: 0.83rem;
            text-align: center;
            transition: background 0.15s, color 0.15s;
        }
        .page-link:hover { background: rgba(193,154,107,0.12); color: var(--text); }
        .logout-btn {
            background: none;
            border: 1px solid var(--border);
            color: var(--muted);
            padding: 0.4rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.82rem;
        }
        .logout-btn:hover { border-color: var(--red); color: var(--red); }
        /* shared button */
        .btn-primary {
            display: inline-flex;
            align-items: center;
            padding: 0.65rem 1.4rem;
            border: none;
            border-radius: 6px;
            font-size: 0.92rem;
            font-weight: 500;
            cursor: pointer;
            background: var(--accent);
            color: #1a0f07;
            transition: opacity 0.2s;
        }
        .btn-primary:hover { opacity: 0.85; }
    </style>
</head>
<body>
<div class="container">

    <h1>&#9702; Site Admin</h1>

    <!-- LOGIN -->
    <div id="loginSection">
        <h2>GitHub Personal Access Token</h2>
        <input type="password" id="patInput" placeholder="ghp_xxxxxxxxxxxxxxxxxxxx" autocomplete="off">
        <p id="loginHint">
            Token needs <strong>repo</strong> scope (classic), or <strong>Contents: Read &amp; write</strong> (fine-grained).<br>
            <a href="https://github.com/settings/tokens/new?scopes=repo&description=SiteAdmin" target="_blank" rel="noopener">Create classic token</a>
        </p>
        <button class="btn-primary" onclick="login()">Login</button>
        <div id="loginStatus"></div>
    </div>

    <!-- LOGGED IN -->
    <div id="loggedSection">
        <p class="user-greeting">Logged in as <strong id="ghUser"></strong></p>

        <a href="../" class="edit-btn">&#9998; Edit Site</a>

        <div class="page-links">
            <a href="../research/" class="page-link">Research</a>
            <a href="../publications/" class="page-link">Publications</a>
            <a href="../teaching/" class="page-link">Teaching</a>
            <a href="../gallery/" class="page-link">Gallery</a>
        </div>

        <button class="logout-btn" onclick="logout()">Logout</button>
    </div>

</div>
<script>
(function () {
    'use strict';

    const API = 'https://api.github.com';
    let ghPat = '';

    function gh(path, opts = {}) {
        return fetch(API + path, {
            ...opts,
            headers: {
                'Authorization': 'token ' + ghPat,
                'Accept':        'application/vnd.github.v3+json',
                ...(opts.headers || {})
            }
        });
    }

    window.login = async function () {
        const pat = document.getElementById('patInput').value.trim();
        if (!pat) return;
        ghPat = pat;

        const loginStatus = document.getElementById('loginStatus');
        loginStatus.style.color = 'var(--muted)';
        loginStatus.textContent = 'Verifyingâ€¦';

        try {
            const r = await gh('/user');
            if (!r.ok) throw new Error('Invalid token (status ' + r.status + ')');
            const user = await r.json();

            localStorage.setItem('adminPat', ghPat);
            document.getElementById('ghUser').textContent = user.login;
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('loggedSection').style.display = 'block';
        } catch (e) {
            loginStatus.style.color = 'var(--red)';
            loginStatus.textContent = e.message;
        }
    };

    window.logout = function () {
        localStorage.removeItem('adminPat');
        ghPat = '';
        document.getElementById('patInput').value = '';
        document.getElementById('loginSection').style.display = 'block';
        document.getElementById('loggedSection').style.display = 'none';
    };

    /* Auto-login if token is already saved */
    const saved = localStorage.getItem('adminPat');
    if (saved) {
        document.getElementById('patInput').value = saved;
        login();
    }
})();
</script>
</body>
</html>
